group test_timelines;

// template group file for use by StringTemplate component in STELLAR project
// take output from timelines app and convert to CRM RDF...

HEADER() ::= <<
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE rdf:RDF [
<!ENTITY rdf "http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<!ENTITY rdfs "http://www.w3.org/2000/01/rdf-schema#">
<!ENTITY xsd "http://www.w3.org/2001/XMLSchema#">
<!ENTITY owl "http://www.w3.org/2002/07/owl#">
<!ENTITY crm "http://purl.org/NET/crm-owl#">
]>
<rdf:RDF 
	xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
	xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
	xmlns:xsd="http://www.w3.org/2001/XMLSchema#"
	xmlns:crm="http://erlangen-crm.org/101001/">
>>

FOOTER() ::= "</rdf:RDF>"


RDFS_LABEL() ::= "<rdfs:label>$it$</rdfs:label>"

CRM_E35(uri, val) ::= <<	
$if(uri)$
	<crm:E35_Title rdf:about="$uri$">
$else$
	<crm:E35_Title>
$endif$
$if(val)$
	<rdf:value>$val$</rdf:value>
$elseif(it)$
	<rdf:value>$it$</rdf:value>
$endif$
</crm:E35_Title>
>>

CRM_E41(uri, val) ::= <<
$if(uri)$<crm:E41_Appellation rdf:about="$uri$">
$else$<crm:E41_Appellation>
$endif$
$if(val)$<rdf:value>$val$</rdf:value>
$elseif(it)$<rdf:value>$it$</rdf:value>
$endif$
</crm:E41_Appellation>
>>

CRM_E42(uri, val) ::= <<
$if(uri)$<crm:E42_Identifier rdf:about="$uri$">
$else$<crm:E42_Identifier>
$endif$
$if(val)$<rdf:value>$val$</rdf:value>
$elseif(it)$<rdf:value>$it$</rdf:value>
$endif$
</crm:E42_Identifier>
>>

//uri/val/it - Allow multiple ways to call template
// using uri: $CRM_E55(uri=record.object_type_uri)$
// using val: $CRM_E55(val=record.object_type)$
// using it: $record.object_type:CRM_E55()
CRM_E55(uri, val) ::= <<
$if(uri)$
	<crm:E55_Type rdf:about="$uri$">
$else$
	<crm:E55_Type>
$endif$
$if(val)$
	<rdf:value>$val$</rdf:value>
$elseif(it)$
	<rdf:value>$it$</rdf:value>
$endif$
<crm:P127_has_broader_term rdf:resource="&claros;ObjectType" />
</crm:E55_Type>
>>

CRM_P1(uri, val) ::= <<
$if(uri)$
	<crm:P1_is_identified_by rdf:resource="$uri$"/>
$elseif(val)$
	<crm:P1_is_identified_by>$val$</crm:P1_is_identified_by>
$elseif(it)$
	<crm:P1_is_identified_by>$it$</crm:P1_is_identified_by>
$endif$
>>

CRM_P2(uri, val) ::= <<
$if(uri)$
	<crm:P2_has_type rdf:resource="$uri$"/>
$elseif(val)$
	<crm:P2_has_type>$val$</crm:P2_has_type>
$elseif(it)$
	<crm:P2_has_type>$it$</crm:P2_has_type>
$endif$
>>

CRM_P3(val) ::= <<
$if(val)$
	<crm:P3_has_note>$val$</crm:P3_has_note>
$elseif(it)$
	<crm:P3_has_note>$it$</crm:P3_has_note>
$endif$
>>

CRM_P48(uri, val) ::= <<
$if(uri)$
	<crm:P48_has_preferred_identifier rdf:resource="$uri$"/>
$elseif(val)$
	<crm:P48_has_preferred_identifier>$val$</crm:P48_has_preferred_identifier>
$elseif(it)$
	<crm:P48_has_preferred_identifier>$it$</crm:P48_has_preferred_identifier>
$endif$
>>

CRM_P102(uri, val) ::= <<
$if(uri)$
	<crm:P102_has_title rdf:resource="$uri$"/>
$elseif(val)$
	<crm:P102_has_title>$val$</crm:P102_has_title>
$elseif(it)$
	<crm:P102_has_title>$it$</crm:P102_has_title>
$endif$
>>

// STELLAR looks for a template called 'MAIN', taking a parameter called 'data'
// that can be iterated and attributes accessed as in the example below:
MAIN(data) ::= <<
$HEADER()$
$data:{ record | 
	$if(record.period_uri)$
		<crm:E4_Period rdf:about="$record.period_uri$">	
	$else$
		<crm:E4_Period>
	$endif$
	$record.period_id:CRM_E41():CRM_P1()$
	$record.period_note:CRM_P3()$
	$if(record.period_type)$
		$CRM_P2(val=CRM_E55(val=record.period_type))$ 
	$endif$ 	

	$! TODO: start year and end year !$
</crm:E4_Period>
}$ 
$FOOTER()$
 >>

